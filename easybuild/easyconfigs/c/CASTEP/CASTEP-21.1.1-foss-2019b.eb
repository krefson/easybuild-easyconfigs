easyblock = 'ConfigureMake'

name = 'CASTEP'
version = '21.1.1'

homepage = 'http://www.castep.org'
description = """CASTEP is an electronic structure materials modelling code based on density functional theory (DFT), with functionality including geometry optimization molecular dynamics, phonons, NMR chemical shifts and much more."""

toolchain = {'name': 'foss', 'version': '2019b'}

# CASTEP is proprietary software, available under a free-of-charge license for academic use only. 
# Visit http://www.castep.org and navigate to "Getting Castep" to apply for a license.

sources     = ['CASTEP-21.11.tar.gz']

skipsteps = [ 'configure' ]

maxparallel  = 16

buildopts = 'COMMS_ARCH=mpi FFT=fftw3 MATHLIBS=openblas FFTLIBDIR= MATHLIBDIR=  castep tools utilities'

preinstallopts = 'mkdir -p %(installdir)s/bin %(installdir)s/lib && touch  %(installdir)s/lib/null &&'

installopts = 'COMMS_ARCH=mpi FFT=fftw3 MATHLIBS=openblas INSTALL_DIR="%(installdir)s/bin" install-castep install-tools install-utilities'

moduleclass = 'phys'
